<div class="card border-0 shadow-sm rounded-4">
    <div class="card-body">
        <h6 class="fw-bold mb-3">
            <i class="bi bi-toggle-on text-success me-2"></i>
            Proporción de ENCENDER vs APAGAR
        </h6>
        <canvas id="graficoTiempo"></canvas>
    </div>
</div>

<script>
let chartTiempo;

async function cargarGraficoTiempo() {
    try {
        const res = await fetch("/api/estadisticas/acciones-por-tipo");
        const data = await res.json();

        const labels = data.labels;
        const valores = data.data;

        if (chartTiempo) chartTiempo.destroy();

        const ctx = document.getElementById("graficoTiempo").getContext("2d");
        chartTiempo = new Chart(ctx, {
            type: "bar",
            data: {
                labels,
                datasets: [{
                    label: "Cantidad de acciones",
                    data: valores,
                    backgroundColor: [
                        "rgba(25, 135, 84, 0.7)", // Encender
                        "rgba(220, 53, 69, 0.7)"  // Apagar
                    ],
                    borderWidth: 1,
                    borderColor: "rgba(0,0,0,0.1)"
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: { beginAtZero: true, title: { display: true, text: "Acciones" } },
                    x: { title: { display: true, text: "Tipo de acción" } }
                },
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        callbacks: {
                            label: ctx => `${ctx.parsed.y} acciones`
                        }
                    }
                }
            }
        });
    } catch (err) {
        console.error("❌ Error en cargarGraficoTiempo:", err);
    }
}
</script>
