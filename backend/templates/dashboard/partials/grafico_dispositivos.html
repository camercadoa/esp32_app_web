<div class="card border-0 shadow-sm rounded-4">
    <div class="card-body">
        <h6 class="fw-bold mb-3">
            <i class="bi bi-pie-chart-fill text-warning me-2"></i>
            Distribuci√≥n de acciones por dispositivo
        </h6>
        <canvas id="graficoDispositivos"></canvas>
    </div>
</div>

<script>
let chartDispositivos;

async function cargarGraficoDispositivos() {
    try {
        const res = await fetch("/api/estadisticas/acciones-por-dispositivo");
        const data = await res.json();

        const labels = data.labels;
        const valores = data.data;

        if (chartDispositivos) chartDispositivos.destroy();

        const ctx = document.getElementById("graficoDispositivos").getContext("2d");
        chartDispositivos = new Chart(ctx, {
            type: "doughnut",
            data: {
                labels,
                datasets: [{
                    data: valores,
                    backgroundColor: [
                        "rgba(13, 110, 253, 0.7)",   // azul
                        "rgba(25, 135, 84, 0.7)",   // verde
                        "rgba(255, 193, 7, 0.7)",   // amarillo
                        "rgba(220, 53, 69, 0.7)"    // rojo
                    ],
                    borderWidth: 1,
                    borderColor: "#fff"
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: "bottom",
                        labels: { boxWidth: 12 }
                    },
                    tooltip: { callbacks: {
                        label: function(ctx) {
                            return `${ctx.label}: ${ctx.parsed} acciones`;
                        }
                    }}
                },
                cutout: "70%"
            }
        });
    } catch (err) {
        console.error("Error en cargarGraficoDispositivos:", err);
    }
}
</script>
